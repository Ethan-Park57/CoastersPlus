---
title: "Final Project"
output: html_document
author: "Ethan Park, Evan Wu, Priyanka Kaul"
date: "28 July, 2023"
css: font.css
---

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("Data.R")
```

```{css, echo = FALSE}
h1, h3 {
  text-align: center;
}
```

```{r Libraries, message = FALSE, echo = FALSE}
library(tidyverse)
library(readxl)
library(patchwork)
library(kableExtra)
library(knitr)
library(ranger)
library(vip)
library(rpart)
library(rpart.plot)
library(gridExtra)
library(caret)
library(mgcv)
library(tidymodels)

set.seed(13*38*51)
```

<br>
<br>

#### Introduction:
Over the past few years, Major League Baseball has seen substantial shifts in
what have traditionally been considered dominant pitches. Mets ace Justin
Verlander remarked earlier this year that sliders haven't been performing as
well as in the past, specifically, OPS on sliders is "the highest it's been in
the pitch tracking years." The introduction of the sweeper, an attempt to
clarify and designate differences between two types of sliders, and new
evaluation metrics such as Stuff+, Location+, and Pitching+, have only added
dimension to the evaluation of specific pitch types and are indicative of a
growing focus on individual pitch characteristics. While the discrete qualities
of a pitch (such as vertical / horizontal movement, velocity, and spin rate) are
undoubtedly useful in evaluating and explaining elite pitchers, the effects that
sequencing and in-game pitching strategy have on outcomes cannot be understated.
Therefore, integrating inter-pitch dynamics with discrete pitch characteristics
might more accurately model a pitcher's effectiveness. Fangraph's Stuff+ metric
does a satisfactory job in evaluating the efficacy of a pitch based on discrete
characteristics, but it is limited in that it fails to consider the art of
pitch sequencing. Our motivation behind this project is to assess pitch
effectiveness and consider how inter-pitch dynamics can enhance existing
evaluation metrics.


<br>
<br>

#### Data:



<br>
<br>

### MLB Population Averages (2020 - 2022):

##### Note Recategorization: 

##### *"Sliders" includes Slurves and Sweepers*

##### *"Curveballs" includes Knuckle Curves*

##### *"Changeup" includes Splitters*

<br>

```{r League Movement, warning = FALSE, message = FALSE, echo = FALSE}
results <- pitches %>% 
  select(-c(pos3_int_start_distance:pos9_int_start_distance))

movement <- Data %>% 
  select(pitch_type, pitch_type_name, Stuff, `Stf+ Pitch`:tail, 
         avg_speed, pitches_thrown, pitch_per, spin_rate, playerID) %>% 
  rename(pitch_prop = pitch_per) %>% 
  filter(!is.na(`Stf+ Pitch`))

league <- movement %>% 
  group_by(pitch_type_name) %>% 
  summarize("horizontal" = 
              weighted.mean(pitcher_break_x, pitches_thrown),
            "vertical" = 
              weighted.mean(pitcher_break_z, pitches_thrown),
            "prop" =  
              weighted.mean(pitch_prop, pitches_thrown),
            "spin" =  
              weighted.mean(spin_rate, pitches_thrown, na.rm = TRUE),
            "speed" =  
              weighted.mean(avg_speed, pitches_thrown, na.rm = TRUE)) %>% 
  as.data.frame() %>% 
  arrange(desc(speed))
  
league %>% 
  kable(digits = 2, align = "c",
        col.names = c("Pitch", "Horizontal", "Vertical",
                      "Pitch Proportion", "Spin Rate", "Speed")) %>% 
  kable_styling(full_width = T)
```

```{r Stuff+ Histogram, echo = FALSE, warning = FALSE}
movement %>% 
  filter(pitch_type == "CU") %>% 
  ggplot() +
  geom_histogram(aes(x = Stuff),
                 color = "white", fill = "darkgray", binwidth = 2) +
  labs(x = "Stuff+", y = "",
       title = "Stuff+ (By Pitcher)") +
  xlim(75, 200) + ylim(0, 15) +
  theme_classic() + theme(plot.title = element_text(hjust = 0.5)) +
  movement %>% 
  filter(pitch_type == "CU") %>% 
  ggplot() +
  geom_histogram(aes(x = `Stf+ Pitch`), 
                 color = "white", fill = "lightgreen", binwidth = 2) +
  labs(x = "Stuff+", y = "",
       title = "Stuff+ (By Pitch)") +
  xlim(75, 200) + ylim(0, 15) +
  theme_classic() + theme(plot.title = element_text(hjust = 0.5))
```

```{r Speed Differential, echo = FALSE, warning = FALSE, message = FALSE}
g_sd1 <- Data2 %>% 
  filter(speed_diff < 0) %>% 
  ggplot(aes(x = speed_diff, y = `Stf+ Pitch`)) +
  theme(panel.background = element_rect("black"),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_line("darkgray")) +
  geom_hline(yintercept = 100, color = "green", size = 1.25, alpha = 0.3) +
  geom_point(shape = 18, size = 2, alpha = 0.8, aes(color = avg_speed)) +
  geom_smooth(se = FALSE, color = "gray92", size = 1.5) +
  labs(x = "",
       y = "Pitch Stuff+",
       color = "Pitch Speed",
       title = "Stuff+ by Speed Differential & Pitch Type") +
  scale_color_gradient(low = "yellow", high = "red", limits = c(70, 100)) +
  theme(plot.title = element_text(hjust = 0.5),
        legend.title = element_text(hjust = 0.5)) +
  scale_x_reverse()

g_sd2 <- Data2 %>% 
  filter(speed_diff < 0) %>% 
  ggplot(aes(x = speed_diff, y = `Stf+ Pitch`)) +
  theme(panel.background = element_rect("black"),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_line("darkgray")) +
  geom_hline(yintercept = 100, color = "yellow", size = 1, alpha = 0.5) +
  geom_point(shape = 18, size = 2, alpha = 0.8, aes(color = pitch_type_name)) +
  geom_smooth(se = FALSE, color = "gray92", size = 1.5) +
  labs(y = "Pitch Stuff+",
       x = "Speed Differential (vs. Fastball)",
       color = "Pitch") +
  theme(legend.title = element_text(hjust = 0.5)) +
  scale_x_reverse()

g_sd1 / g_sd2

rm(g_sd1)
rm(g_sd2)
```

```{r Pitch Prop, echo = FALSE, warning = FALSE, message = FALSE}
Data2 %>% 
  ggplot(aes(x = `Stf+ Pitch`, y = (pitch_per-league$prop)/league$prop,
             color = woba)) +
  theme(panel.background = element_rect("black"),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_line("darkgray")) +
  geom_hline(yintercept = 0, color = "yellow", size = 1, alpha = 0.7) +
  geom_vline(xintercept = 100, color = "yellow", size = 1, alpha = 0.7) +
  geom_point(alpha = 0.8) +
  geom_smooth(se = FALSE, color = "gray92", size = 1.5) +
  labs(x = "Pitch Stuff+",
       y = "Pitch Usage (vs. League Average)",
       color = "wOBA") +
  scale_color_gradient(low = "green", high = "red") +
  scale_y_continuous(limits = c(-1,2.5), labels = scales::percent) +
  NULL

```

```{r Tree of Component Variables, echo = FALSE}
# Lots of Variables
tree_input <- Data2 %>% 
  select(Name, year, pitch_hand:Stuff, `Stf+ Pitch`, pitcher_break_z,
         pitcher_break_x, avg_speed, spin_rate, pitches_thrown, pitch_per,
         run_value:hard_hit_percent, fb_type:speed_diff) %>% 
  filter(!is.na(`Stf+ Pitch`), !is.na(run_value), !is.na(spin_rate),
         !is.na(fb_stuff), !is.na(fb_speed), !is.na(fb_thrown),
         !is.na(speed_diff)) %>% 
  select(-Name:-pitch_type_name, -fb_type) %>% 
  rename(pitch_stuff = `Stf+ Pitch`) %>% 
  select(-est_woba, -slg, -ba, -rv100, -run_value, -est_slg,
         -est_ba)

model_data_full <- tree_input %>% 
  select(woba, pitch_stuff, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate,
         pitch_per, fb_stuff, fb_thrown, speed_diff) %>% 
  filter(speed_diff != 0)


rpart(formula =woba ~ pitch_stuff + pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_per + fb_stuff + fb_thrown + 
                  speed_diff,
     data = model_data_full, method = "anova") %>%
  rpart.plot()


# Fewer Variables
model_data_reduced <- tree_input %>% 
  select(woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, 
         speed_diff) %>% 
  filter(speed_diff != 0) %>% 
  select(-speed_diff)

model_reduced <- ranger(woba ~ ., data = model_data_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(model_reduced, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate") +
  theme_bw()
```

<center>
## **Pitch-by-Pitch Breakdowns:**
</center>

<br>

### Variable Importance Plots {.tabset}
###### Sinkers, Cutters, and Four-Seam Fastballs have been aggregated into a singular "Fastball" category.

#### wOBA {.tabset}
##### Fastballs
```{r Fastballs wOBA VIP, echo = FALSE}

fastball_reduced <- Data2 %>% 
  filter(pitch_type == "FC" | pitch_type == "FF" | pitch_type == "SI") %>% 
  select(woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

fastball_model <- ranger(woba ~ ., data = fastball_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(fastball_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate") +
  theme_bw()

```

##### Sliders
```{r Slider wOBA VIP, echo = FALSE}

slider_reduced <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  select(woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, 
         speed_diff) %>% 
  filter(!is.na(spin_rate), !is.na(speed_diff))

slider_model <- ranger(woba ~ ., data = slider_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(slider_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff") +
  theme_bw()

```

##### Curveballs
```{r Curveballs wOBA VIP, echo = FALSE}
curveball_reduced <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  select(woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff) %>% 
  filter(!is.na(spin_rate), !is.na(speed_diff))

curveball_model <- ranger(woba ~ ., data = curveball_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(curveball_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff") +
  theme_bw()

```

##### Change-Ups
```{r Change-Ups wOBA VIP, echo = FALSE}
changeup_reduced <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  select(woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff) %>% 
  filter(!is.na(spin_rate), !is.na(speed_diff))

changeup_model <- ranger(woba ~ ., data = changeup_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(changeup_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff") +
  theme_bw()

```

#### {-}

#### xwOBA {.tabset}
##### Fastballs
```{r Fastballs xwOBA VIP, echo = FALSE}

x_fastball_reduced <- Data2 %>% 
  filter(pitch_type == "FC" | pitch_type == "FF" | pitch_type == "SI") %>% 
  select(est_woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

x_fastball_model <- ranger(est_woba ~ ., data = x_fastball_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(x_fastball_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate") +
  theme_bw()

```

##### Sliders
```{r Slider xwOBA VIP, echo = FALSE}

x_slider_reduced <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  select(est_woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, 
         speed_diff) %>% 
  filter(!is.na(spin_rate), !is.na(speed_diff))

x_slider_model <- ranger(est_woba ~ ., data = x_slider_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(x_slider_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff") +
  theme_bw()

```

##### Curveballs
```{r Curveballs xwOBA VIP, echo = FALSE}
x_curveball_reduced <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  select(est_woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff) %>% 
  filter(!is.na(spin_rate), !is.na(speed_diff))

x_curveball_model <- ranger(est_woba ~ ., data = x_curveball_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(x_curveball_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff") +
  theme_bw()

```

##### Change-Ups
```{r Change-Ups xwOBA VIP, echo = FALSE}
x_changeup_reduced <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  select(est_woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff) %>% 
  filter(!is.na(spin_rate), !is.na(speed_diff))

x_changeup_model <- ranger(est_woba ~ ., data = x_changeup_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(x_changeup_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff") +
  theme_bw()

```

#### {-}

#### Run Value / 100 {.tabset}
##### Fastballs
```{r Fastballs RV VIP, echo = FALSE}

rv_fastball_reduced <- Data2 %>% 
  filter(pitch_type == "FC" | pitch_type == "FF" | pitch_type == "SI") %>% 
  select(rv100, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rv_fastball_model <- ranger(rv100 ~ ., data = rv_fastball_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(rv_fastball_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate") +
  theme_bw()

```

##### Sliders
```{r Slider RV VIP, echo = FALSE}

rv_slider_reduced <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  select(rv100, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, 
         speed_diff) %>% 
  filter(!is.na(spin_rate), !is.na(speed_diff))

rv_slider_model <- ranger(rv100 ~ ., data = rv_slider_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(rv_slider_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff") +
  theme_bw()

```

##### Curveballs
```{r Curveballs RV VIP, echo = FALSE}
rv_curveball_reduced <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  select(rv100, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff) %>% 
  filter(!is.na(spin_rate), !is.na(speed_diff))

rv_curveball_model <- ranger(rv100 ~ ., data = rv_curveball_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(rv_curveball_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff") +
  theme_bw()

```

##### Change-Ups
```{r Change-Ups RV VIP, echo = FALSE}
rv_changeup_reduced <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  select(rv100, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff) %>% 
  filter(!is.na(spin_rate), !is.na(speed_diff))

rv_changeup_model <- ranger(rv100 ~ ., data = rv_changeup_reduced, num.trees = 1000,
                      importance = "impurity") 

vip(rv_changeup_model, geom = "point") + 
  labs(title = "Reduced Model",
       caption = "Variables: pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, speed_diff") +
  theme_bw()

```

#### {-}

### {-}


### Decision Trees {.tabset}

#### wOBA {.tabset}
##### Four-Seam
```{r Four Seams wOBA Tree, echo = FALSE}
fourseam_reduced <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  select(woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rpart(formula = woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_type,
     data = fourseam_reduced, method = "anova") %>%
  rpart.plot()
```

##### Cutters
```{r Cutters wOBA Tree, echo = FALSE}
cutter_reduced <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  select(woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rpart(formula = woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_type,
     data = cutter_reduced, method = "anova") %>%
  rpart.plot()
```

##### Sinkers
```{r Sinkers wOBA Tree, echo = FALSE}
sinker_reduced <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  select(woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rpart(formula = woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_type,
     data = sinker_reduced, method = "anova") %>%
  rpart.plot()
```

##### Sliders
```{r Sliders wOBA Tree, echo = FALSE}
rpart(formula = woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate,
     data = slider_reduced, method = "anova") %>%
  rpart.plot()

```

##### Curveballs
```{r Curveballs wOBA Tree, echo = FALSE}

rpart(formula = woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate,
     data = curveball_reduced, method = "anova") %>%
  rpart.plot()
```

##### Change-Ups
```{r Change-Ups wOBA Tree, echo = FALSE}

rpart(formula = woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate,
     data = changeup_reduced, method = "anova") %>%
  rpart.plot()
```

#### {-}

#### xwOBA {.tabset}
##### Four-Seam
```{r Four Seams xwOBA Tree, echo = FALSE}
x_fourseam_reduced <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  select(est_woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rpart(formula = est_woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_type,
     data = x_fourseam_reduced, method = "anova") %>%
  rpart.plot()
```

##### Cutters
```{r Cutters xwOBA Tree, echo = FALSE}
x_cutter_reduced <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  select(est_woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rpart(formula = est_woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_type,
     data = x_cutter_reduced, method = "anova") %>%
  rpart.plot()
```

##### Sinkers
```{r Sinkers xwOBA Tree, echo = FALSE}
x_sinker_reduced <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  select(est_woba, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rpart(formula = est_woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_type,
     data = x_sinker_reduced, method = "anova") %>%
  rpart.plot()
```

##### Sliders
```{r Sliders xwOBA Tree, echo = FALSE}
rpart(formula = est_woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate,
     data = x_slider_reduced, method = "anova") %>%
  rpart.plot()

```

##### Curveballs
```{r Curveballs xwOBA Tree, echo = FALSE}

rpart(formula = est_woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate,
     data = x_curveball_reduced, method = "anova") %>%
  rpart.plot()
```

##### Change-Ups
```{r Change-Ups xwOBA Tree, echo = FALSE}

rpart(formula = est_woba ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate,
     data = x_changeup_reduced, method = "anova") %>%
  rpart.plot()
```

#### {-}

#### Run Value / 100 {.tabset}
##### Four-Seam
```{r Four Seams RV Tree, echo = FALSE}
rv_fourseam_reduced <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  select(rv100, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rpart(formula = rv100 ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_type,
     data = rv_fourseam_reduced, method = "anova") %>%
  rpart.plot()
```

##### Cutters
```{r Cutters RV Tree, echo = FALSE}
rv_cutter_reduced <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  select(rv100, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rpart(formula = rv100 ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_type,
     data = rv_cutter_reduced, method = "anova") %>%
  rpart.plot()
```

##### Sinkers
```{r Sinkers RV Tree, echo = FALSE}
rv_sinker_reduced <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  select(rv100, pitcher_break_z, pitcher_break_x, avg_speed, spin_rate, pitch_type) %>% 
  filter(!is.na(spin_rate))

rpart(formula = rv100 ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate + pitch_type,
     data = rv_sinker_reduced, method = "anova") %>%
  rpart.plot()
```

##### Sliders
```{r Sliders RV Tree, echo = FALSE}
rpart(formula = rv100 ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate,
     data = rv_slider_reduced, method = "anova") %>%
  rpart.plot()

```

##### Curveballs
```{r Curveballs RV Tree, echo = FALSE}
rpart(formula = rv100 ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate,
     data = rv_curveball_reduced, method = "anova") %>%
  rpart.plot()
```

##### Change-Ups
```{r Change-Ups RV Tree, echo = FALSE}

rpart(formula = rv100 ~ pitcher_break_z + pitcher_break_x + 
                  avg_speed + spin_rate,
     data = rv_changeup_reduced, method = "anova") %>%
  rpart.plot()
```

#### {-}

### {-}


### Pitch Characteristics {.tabset}

#### wOBA {.tabset}
##### Four-Seam
```{r Four Seams wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g_ff_1 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = spin_rate, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "wOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g_ff_2 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = avg_speed, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g_ff_1, g_ff_2, ncol = 2, top = "wOBA on Four-Seam Fastballs by Spin Rate & Speed")
```

##### Cutters
```{r Cutters wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g_fc_1 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = spin_rate, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "wOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g_fc_2 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = avg_speed, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g_fc_1, g_fc_2, ncol = 2, top = "wOBA on Cutters by Spin Rate & Speed")
```

##### Sinkers
```{r Sinkers wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g_si_1 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = spin_rate, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "wOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g_si_2 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = avg_speed, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g_si_1, g_si_2, ncol = 2, top = "wOBA on Sinkers by Spin Rate & Speed")
```

##### Sliders
```{r Sliders wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g_sl_1 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = spin_rate, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "wOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g_sl_2 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = avg_speed, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g_sl_1, g_sl_2, ncol = 2, top = "wOBA on Sliders by Spin Rate & Speed")
```

##### Curveballs
```{r Curveballs wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g_cu_1 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = spin_rate, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "wOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g_cu_2 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = avg_speed, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g_cu_1, g_cu_2, ncol = 2, top = "wOBA on Curveballs by Spin Rate & Speed")
```

##### Change-Ups
```{r Change-Ups wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g_ch_1 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = spin_rate, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "wOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g_ch_2 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = avg_speed, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g_ch_1, g_ch_2, ncol = 2, top = "wOBA on Change-Ups by Spin Rate & Speed")
```

#### {-}

#### xwOBA {.tabset}
##### Four-Seam
```{r Four Seams xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx_ff_1 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = spin_rate, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "xwOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx_ff_2 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = avg_speed, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx_ff_1, gx_ff_2, ncol = 2, top = "xwOBA on Four-Seam Fastballs by Spin Rate & Speed")
```

##### Cutters
```{r Cutters xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx_fc_1 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = spin_rate, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "xwOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx_fc_2 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = avg_speed, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx_fc_1, gx_fc_2, ncol = 2, top = "xwOBA on Cutters by Spin Rate & Speed")
```

##### Sinkers
```{r Sinkers xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx_si_1 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = spin_rate, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "xwOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx_si_2 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = avg_speed, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx_si_1, gx_si_2, ncol = 2, top = "xwOBA on Sinkers by Spin Rate & Speed")
```

##### Sliders
```{r Sliders xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx_sl_1 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = spin_rate, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "xwOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx_sl_2 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = avg_speed, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx_sl_1, gx_sl_2, ncol = 2, top = "xwOBA on Sliders by Spin Rate & Speed")
```

##### Curveballs
```{r Curveballs xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx_cu_1 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = spin_rate, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "xwOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx_cu_2 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = avg_speed, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx_cu_1, gx_cu_2, ncol = 2, top = "xwOBA on Curveballs by Spin Rate & Speed")
```

##### Change-Ups
```{r Change-Ups xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx_ch_1 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = spin_rate, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "xwOBA",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx_ch_2 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = avg_speed, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx_ch_1, gx_ch_2, ncol = 2, top = "xwOBA on Change-Ups by Spin Rate & Speed")
```

#### {-}

#### Run Value / 100 {.tabset}
##### Four-Seam
```{r Four Seams RV, warning = FALSE, message = FALSE, echo = FALSE}
grv_ff_1 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = spin_rate, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "Run Value / 100",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv_ff_2 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = avg_speed, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv_ff_1, grv_ff_2, ncol = 2, top = "Run Value on Four-Seam Fastballs by Spin Rate & Speed")
```

##### Cutters
```{r Cutters RV, warning = FALSE, message = FALSE, echo = FALSE}
grv_fc_1 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = spin_rate, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "Run Value / 100",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv_fc_2 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = avg_speed, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv_fc_1, grv_fc_2, ncol = 2, top = "Run Value on Cutters by Spin Rate & Speed")
```

##### Sinkers
```{r Sinkers RV, warning = FALSE, message = FALSE, echo = FALSE}
grv_si_1 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = spin_rate, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "Run Value / 100",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv_si_2 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = avg_speed, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv_si_1, grv_si_2, ncol = 2, top = "Run Value on Sinkers by Spin Rate & Speed")
```

##### Sliders
```{r Sliders RV, warning = FALSE, message = FALSE, echo = FALSE}
grv_sl_1 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = spin_rate, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "Run Value / 100",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv_sl_2 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = avg_speed, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv_sl_1, grv_sl_2, ncol = 2, top = "Run Value on Sliders by Spin Rate & Speed")
```

##### Curveballs
```{r Curveballs RV, warning = FALSE, message = FALSE, echo = FALSE}
grv_cu_1 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = spin_rate, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "Run Value / 100",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv_cu_2 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = avg_speed, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv_cu_1, grv_cu_2, ncol = 2, top = "Run Value on Curveballs by Spin Rate & Speed")
```

##### Change-Ups
```{r Change-Ups RV, warning = FALSE, message = FALSE, echo = FALSE}
grv_ch_1 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = spin_rate, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Spin Rate (rpm)",
       y = "Run Value / 100",
       subtitle = "Spin Rate") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_continuous(labels = scales::comma) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv_ch_2 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = avg_speed, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Average Pitch Speed (mph)",
       y = "",
       color = "Stuff+",
       subtitle = "Speed") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv_ch_1, grv_ch_2, ncol = 2, top = "Run Value on Change-Ups by Spin Rate & Speed")
```

#### {-}

### {-}


### Pitch Movement {.tabset}

#### wOBA {.tabset}
##### Four-Seam
```{r Four Seams M wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g2_ff_1 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = pitcher_break_x, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "wOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g2_ff_2 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = pitcher_break_z, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g2_ff_1, g2_ff_2, ncol = 2, top = "wOBA on Four Seam Fastballs by Pitch Movement")
```

##### Cutters
```{r Cutters M wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g2_fc_1 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = pitcher_break_x, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "wOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g2_fc_2 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = pitcher_break_z, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g2_fc_1, g2_fc_2, ncol = 2, top = "wOBA on Cutters by Pitch Movement")
```

##### Sinkers
```{r Sinkers M wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g2_si_1 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = pitcher_break_x, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "wOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g2_si_2 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = pitcher_break_z, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g2_fc_1, g2_fc_2, ncol = 2, top = "wOBA on Sinkers by Pitch Movement")
```

##### Sliders
```{r Sliders M wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g2_sl_1 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = pitcher_break_x, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "wOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g2_sl_2 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = pitcher_break_z, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g2_sl_1, g2_sl_2, ncol = 2, top = "wOBA on Sliders by Pitch Movement")
```

##### Curveballs
```{r Curveballs M wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g2_cu_1 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = pitcher_break_x, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "wOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g2_cu_2 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = pitcher_break_z, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(g2_cu_1, g2_cu_2, ncol = 2, top = "wOBA on Curveballs by Pitch Movement")
```

##### Change-Ups
```{r Change-Ups M wOBA, warning = FALSE, message = FALSE, echo = FALSE}
g2_ch_1 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = pitcher_break_x, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE, aes(shape = pitch_type_name), size = 2) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "Run Value / 100",
       shape = "Pitch Type") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_shape_manual(values = c(20, 18)) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

g2_ch_2 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = pitcher_break_z, y = woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, aes(shape = pitch_type_name), size = 2) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+",
       shape = "Pitch Type") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_shape_manual(values = c(20, 18)) +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        legend.key = element_rect(fill = NA))

grid.arrange(g2_ch_1, g2_ch_2, ncol = 2, top = "wOBA on Change-Ups by Pitch Movement")
```

#### {-}

#### xwOBA {.tabset}
##### Four-Seam
```{r Four Seams M xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx2_ff_1 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = pitcher_break_x, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "xwOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx2_ff_2 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = pitcher_break_z, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx2_ff_1, gx2_ff_2, ncol = 2, top = "xwOBA on Four Seam Fastballs by Pitch Movement")
```

##### Cutters
```{r Cutters M xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx2_fc_1 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = pitcher_break_x, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "xwOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx2_fc_2 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = pitcher_break_z, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx2_fc_1, gx2_fc_2, ncol = 2, top = "xwOBA on Cutters by Pitch Movement")
```

##### Sinkers
```{r Sinkers M xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx2_si_1 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = pitcher_break_x, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "xwOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx2_si_2 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = pitcher_break_z, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx2_si_1, gx2_si_2, ncol = 2, top = "xwOBA on Sinkers by Pitch Movement")
```

##### Sliders
```{r Sliders M xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx2_sl_1 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = pitcher_break_x, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "xwOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx2_sl_2 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = pitcher_break_z, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx2_sl_1, gx2_sl_2, ncol = 2, top = "xwOBA on Sliders by Pitch Movement")
```

##### Curveballs
```{r Curveballs M xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx2_cu_1 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = pitcher_break_x, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "xwOBA") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx2_cu_2 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = pitcher_break_z, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(gx2_cu_1, gx2_cu_2, ncol = 2, top = "xwOBA on Curveballs by Pitch Movement")
```

##### Change-Ups
```{r Change-Ups M xwOBA, warning = FALSE, message = FALSE, echo = FALSE}
gx2_ch_1 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = pitcher_break_x, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE, aes(shape = pitch_type_name), size = 2) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "Run Value / 100",
       shape = "Pitch Type") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_shape_manual(values = c(20, 18)) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

gx2_ch_2 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = pitcher_break_z, y = est_woba, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, aes(shape = pitch_type_name), size = 2) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+",
       shape = "Pitch Type") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_shape_manual(values = c(20, 18)) +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        legend.key = element_rect(fill = NA))

grid.arrange(gx2_ch_1, gx2_ch_2, ncol = 2, top = "xwOBA on Change-Ups by Pitch Movement")
```

#### {-}

#### Run Value / 100 {.tabset}
##### Four-Seam
```{r Four Seams M RV, warning = FALSE, message = FALSE, echo = FALSE}
grv2_ff_1 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = pitcher_break_x, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "Run Value / 100") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv2_ff_2 <- Data2 %>% 
  filter(pitch_type == "FF") %>% 
  ggplot(aes(x = pitcher_break_z, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv2_ff_1, grv2_ff_2, ncol = 2, top = "Run Value on Four Seam Fastballs by Pitch Movement")
```

##### Cutters
```{r Cutters M RV, warning = FALSE, message = FALSE, echo = FALSE}
grv2_fc_1 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = pitcher_break_x, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "Run Value / 100") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv2_fc_2 <- Data2 %>% 
  filter(pitch_type == "FC") %>% 
  ggplot(aes(x = pitcher_break_z, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv2_fc_1, grv2_fc_2, ncol = 2, top = "Run Value on Cutters by Pitch Movement")
```

##### Sinkers
```{r Sinkers M RV, warning = FALSE, message = FALSE, echo = FALSE}
grv2_si_1 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = pitcher_break_x, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "Run Value / 100") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv2_si_2 <- Data2 %>% 
  filter(pitch_type == "SI") %>% 
  ggplot(aes(x = pitcher_break_z, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv2_si_1, grv2_si_2, ncol = 2, top = "Run Value on Sinkers by Pitch Movement")
```

##### Sliders
```{r Sliders M RV, warning = FALSE, message = FALSE, echo = FALSE}
grv2_sl_1 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = pitcher_break_x, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "Run Value / 100") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv2_sl_2 <- Data2 %>% 
  filter(pitch_type == "SL") %>% 
  ggplot(aes(x = pitcher_break_z, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv2_sl_1, grv2_sl_2, ncol = 2, top = "Run Value on Sliders by Pitch Movement")
```

##### Curveballs
```{r Curveballs M RV, warning = FALSE, message = FALSE, echo = FALSE}
grv2_cu_1 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = pitcher_break_x, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "Run Value / 100") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv2_cu_2 <- Data2 %>% 
  filter(pitch_type == "CU") %>% 
  ggplot(aes(x = pitcher_break_z, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

grid.arrange(grv2_cu_1, grv2_cu_2, ncol = 2, top = "Run Value on Curveballs by Pitch Movement")
```

##### Change-Ups
```{r Change-Ups M RV, warning = FALSE, message = FALSE, echo = FALSE}
grv2_ch_1 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = pitcher_break_x, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, show.legend = FALSE, aes(shape = pitch_type_name), size = 2) +
  geom_smooth(method = lm, se = FALSE, show.legend = FALSE) + 
  labs(x = "Horizontal Movement (in.)",
       y = "Run Value / 100",
       shape = "Pitch Type") +
  scale_color_gradient(low = "red", high = "green") +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_shape_manual(values = c(20, 18)) +
  theme_dark() +
  theme(plot.subtitle = element_text(hjust = 0.5))

grv2_ch_2 <- Data2 %>% 
  filter(pitch_type == "CH" | pitch_type == "FS") %>% 
  ggplot(aes(x = pitcher_break_z, y = rv100, 
             color = `Stf+ Pitch`)) +
  geom_point(alpha = 0.7, aes(shape = pitch_type_name), size = 2) +
  geom_smooth(method = lm, se = FALSE) + 
  labs(x = "Vertical Movement (in.)",
       y = "",
       color = "Stuff+",
       shape = "Pitch Type") +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_shape_manual(values = c(20, 18)) +
  scale_color_gradient(low = "red", high = "green") +
  theme_dark()+
  theme(plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        legend.key = element_rect(fill = NA))

grid.arrange(grv2_ch_1, grv2_ch_2, ncol = 2, top = "Run Value on Change-Ups by Pitch Movement")
```

#### {-}

### {-}


```{r GAM 2 CV, echo = FALSE, message = FALSE}
groups <- Data2 %>%
  select(pitcher_id) %>% 
  distinct(pitcher_id) %>% 
  rowwise() %>%
  mutate(group = sample(seq(1, 5, 1), 1))

data_gam <- Data2 %>% 
  select(Name, year, pitch_type, pitch_type_name, pitcher_id, avg_speed, 
         spin_rate, pitcher_break_x, pitcher_break_z, speed_diff, `Stf+ Pitch`,
         pitch_per, whiff_percent, 
         woba, est_woba, rv100) %>% 
  left_join(groups, by = "pitcher_id") %>% 
  rename(stf_pitch = `Stf+ Pitch`)

cv <- function(pitch, fold){

cv_d <- data_gam %>% filter(pitch_type == pitch, group != fold)
  
cv_m <- gam(est_woba ~ s(stf_pitch), data = cv_d, family = gaussian, method = "REML")

cv_p <- data_gam %>% filter(pitch_type == pitch, group == fold)

cv_p <- cv_p %>% mutate(prediction = predict(cv_m, cv_p)) %>% 
  filter(!is.na(prediction))
}


rmse <- function(observed, predicted){
  n <- length(observed)
  sqrt(sum((observed - predicted)^2) / n)}


fourseam <- rbind(cv("FF", "1"),
                  cv("FF", "2"),
                  cv("FF", "3"),
                  cv("FF", "4"),
                  cv("FF", "5"))
  
cutter <- rbind(cv("FC", "1"),
                cv("FC", "2"),
                cv("FC", "3"),
                cv("FC", "4"),
                cv("FC", "5"))

sinker <- rbind(cv("SI", "1"),
                cv("SI", "2"),
                cv("SI", "3"),
                cv("SI", "4"),
                cv("SI", "5"))
  
cutter <- rbind(cv("FC", "1"),
                cv("FC", "2"),
                cv("FC", "3"),
                cv("FC", "4"),
                cv("FC", "5"))

slider <- rbind(cv("SL", "1"),
                cv("SL", "2"),
                cv("SL", "3"),
                cv("SL", "4"),
                cv("SL", "5"))

curveball <- rbind(cv("CU", "1"),
                   cv("CU", "2"),
                   cv("CU", "3"),
                   cv("CU", "4"),
                   cv("CU", "5"))
  
changeup <- rbind(cv("CH", "1"),
                  cv("CH", "2"),
                  cv("CH", "3"),
                  cv("CH", "4"),
                  cv("CH", "5"))

gam_pred <- rbind(fourseam, cutter, sinker, slider, curveball, changeup)



gam_pred %>% 
  ggplot(aes(x = est_woba, y = prediction)) +
  geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
  geom_smooth(se = FALSE, method = lm) +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_reverse() +
  scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  labs(x = "Observed",
       y = "Predicted",
       title = "Stuff+ GAM Predictions of xwOBA",
       caption = paste("RMSE:",
                       round(rmse(gam_pred$est_woba, gam_pred$prediction), 4))) +
  theme_dark() +
  theme(plot.title = element_text(hjust = 0.5))


rmse(gam_pred$est_woba, gam_pred$prediction)
```

```{r GAM 3 CV, echo = FALSE, message = FALSE}
data_gam <- Data2 %>%
  mutate(fb_prop = fb_thrown/total_pitches) %>% 
  mutate(pr = pitch_per/fb_prop) %>% 
  select(Name, year, pitch_type, pitch_type_name, pitcher_id, avg_speed, 
         spin_rate, pitcher_break_x, pitcher_break_z, speed_diff, `Stf+ Pitch`,
         pitch_per, whiff_percent, 
         woba, est_woba, rv100, pr, speed_diff, whiff_percent) %>% 
  left_join(groups, by = "pitcher_id") %>% 
  rename(stf_pitch = `Stf+ Pitch`)

cv2 <- function(pitch, fold){

cv_d <- data_gam %>% filter(pitch_type == pitch, group != fold)
  
cv_m <- gam(est_woba ~ s(stf_pitch) + s(speed_diff) + s(pr) + s(whiff_percent),
            data = cv_d, family = gaussian, method = "REML")

cv_p <- data_gam %>% filter(pitch_type == pitch, group == fold)

cv_p <- cv_p %>% mutate(prediction = predict(cv_m, cv_p)) %>% 
  filter(!is.na(prediction))
}


rmse <- function(observed, predicted){
  n <- length(observed)
  sqrt(sum((observed - predicted)^2) / n)}


fourseam2 <- rbind(cv2("FF", "1"),
                  cv2("FF", "2"),
                  cv2("FF", "3"),
                  cv2("FF", "4"),
                  cv2("FF", "5"))
  
cutter2 <- rbind(cv2("FC", "1"),
                cv2("FC", "2"),
                cv2("FC", "3"),
                cv2("FC", "4"),
                cv2("FC", "5"))

sinker2 <- rbind(cv2("SI", "1"),
                cv2("SI", "2"),
                cv2("SI", "3"),
                cv2("SI", "4"),
                cv2("SI", "5"))
  
cutter2 <- rbind(cv2("FC", "1"),
                cv2("FC", "2"),
                cv2("FC", "3"),
                cv2("FC", "4"),
                cv2("FC", "5"))

slider2 <- rbind(cv2("SL", "1"),
                cv2("SL", "2"),
                cv2("SL", "3"),
                cv2("SL", "4"),
                cv2("SL", "5"))

curveball2 <- rbind(cv2("CU", "1"),
                   cv2("CU", "2"),
                   cv2("CU", "3"),
                   cv2("CU", "4"),
                   cv2("CU", "5"))
  
changeup2 <- rbind(cv2("CH", "1"),
                  cv2("CH", "2"),
                  cv2("CH", "3"),
                  cv2("CH", "4"),
                  cv2("CH", "5"))

gam_pred2 <- rbind(fourseam2, cutter2, sinker2, slider2, curveball2, changeup2)



gam_pred2 %>% 
  ggplot(aes(x = est_woba, y = prediction)) +
  geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
  geom_smooth(se = FALSE, method = lm) +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_reverse() +
  scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  labs(x = "Observed",
       y = "Predicted",
       title = "Intra-Pitch GAM Predictions of xwOBA",
       caption = paste("RMSE:",
                       round(rmse(gam_pred2$est_woba, gam_pred2$prediction), 4))) +
  theme_dark() +
  theme(plot.title = element_text(hjust = 0.5))


rmse(gam_pred$est_woba, gam_pred$prediction)



curveball %>% 
  ggplot(aes(x = est_woba, y = prediction)) +
  geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
  geom_smooth(se = FALSE, method = lm) +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_reverse() +
  scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  labs(x = "Observed",
       y = "Predicted",
       title = "Inter-Pitch GAM Predictions of xwOBA for Curveballs",
       caption = paste("RMSE:",
                       round(rmse(curveball$est_woba, curveball$prediction), 4))) +
  theme_dark() +
  theme(plot.title = element_text(hjust = 0.5))

curveball2 %>% 
  ggplot(aes(x = est_woba, y = prediction)) +
  geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
  geom_smooth(se = FALSE, method = lm) +
  scale_y_reverse() +
  scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  scale_x_reverse() +
  scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
                     expand = expansion(mult = c(0, 0.05)),
                     trans = "reverse") +
  labs(x = "Observed",
       y = "Predicted",
       title = "Intra-Pitch GAM Predictions of xwOBA for Curveballs",
       caption = paste0("Inter-Pitch RMSE: ",
                       round(rmse(curveball2$est_woba, curveball2$prediction), 4),". Intra-Pitch RMSE: ", round(rmse(curveball$est_woba, curveball$prediction), 4))) +
  theme_dark() +
  theme(plot.title = element_text(hjust = 0.5))


rmse(slider$est_woba, slider$prediction)
rmse(slider2$est_woba, slider2$prediction)

rmse(curveball$est_woba, curveball$prediction)
rmse(curveball2$est_woba, curveball2$prediction)

rmse(fourseam$est_woba, fourseam$prediction)
rmse(fourseam2$est_woba, fourseam2$prediction)

rmse(cutter$est_woba, cutter$prediction)
rmse(cutter2$est_woba, cutter2$prediction)

rmse(changeup$est_woba, changeup$prediction)
rmse(changeup2$est_woba, changeup2$prediction)

rmse(sinker$est_woba, sinker$prediction)
rmse(sinker2$est_woba, sinker2$prediction)

```

```{r Delete Environment, echo = FALSE, eval = FALSE}
# PC wOBA
rm(g_ch_1)
rm(g_ch_2)
rm(g_cu_1)
rm(g_cu_2)
rm(g_sl_1)
rm(g_sl_2)
rm(g_fc_1)
rm(g_fc_2)
rm(g_ff_1)
rm(g_ff_2)
rm(g_si_1)
rm(g_si_2)

# PC xwOBA
rm(gx_ch_1)
rm(gx_ch_2)
rm(gx_cu_1)
rm(gx_cu_2)
rm(gx_ff_1)
rm(gx_ff_2)
rm(gx_fc_1)
rm(gx_fc_2)
rm(gx_si_1)
rm(gx_si_2)
rm(gx_sl_1)
rm(gx_sl_2)

# PC Run Value
rm(grv_ch_1)
rm(grv_ch_2)
rm(grv_cu_1)
rm(grv_cu_2)
rm(grv_sl_1)
rm(grv_sl_2)
rm(grv_fc_1)
rm(grv_fc_2)
rm(grv_ff_1)
rm(grv_ff_2)
rm(grv_si_1)
rm(grv_si_2)

# VIP wOBA
rm(changeup_model)
rm(changeup_reduced)
rm(curveball_model)
rm(curveball_reduced)
rm(slider_model)
rm(slider_reduced)
rm(fastball_model)
rm(fastball_reduced)
rm(fourseam_reduced)
rm(cutter_reduced)
rm(sinker_reduced)

# VIP xwOBA
rm(x_changeup_model)
rm(x_changeup_reduced)
rm(x_curveball_model)
rm(x_curveball_reduced)
rm(x_fastball_model)
rm(x_fastball_reduced)
rm(x_slider_model)
rm(x_slider_reduced)
rm(x_fourseam_reduced)
rm(x_cutter_reduced)
rm(x_sinker_reduced)

# VIP Run Value
rm(rv_changeup_model)
rm(rv_changeup_reduced)
rm(rv_curveball_model)
rm(rv_curveball_reduced)
rm(rv_slider_model)
rm(rv_slider_reduced)
rm(rv_fastball_model)
rm(rv_fastball_reduced)
rm(rv_fourseam_reduced)
rm(rv_cutter_reduced)
rm(rv_sinker_reduced)

# PM wOBA
rm(g2_ch_1)
rm(g2_ch_2)
rm(g2_cu_1)
rm(g2_cu_2)
rm(g2_fc_1)
rm(g2_fc_2)
rm(g2_ff_1)
rm(g2_ff_2)
rm(g2_si_1)
rm(g2_si_2)
rm(g2_sl_1)
rm(g2_sl_2)

# PM xwOBA
rm(gx2_ch_1)
rm(gx2_ch_2)
rm(gx2_cu_1)
rm(gx2_cu_2)
rm(gx2_fc_1)
rm(gx2_fc_2)
rm(gx2_ff_1)
rm(gx2_ff_2)
rm(gx2_si_1)
rm(gx2_si_2)
rm(gx2_sl_1)
rm(gx2_sl_2)

# PM Run Value
rm(grv2_ch_1)
rm(grv2_ch_2)
rm(grv2_cu_1)
rm(grv2_cu_2)
rm(grv2_fc_1)
rm(grv2_fc_2)
rm(grv2_ff_1)
rm(grv2_ff_2)
rm(grv2_si_1)
rm(grv2_si_2)
rm(grv2_sl_1)
rm(grv2_sl_2)

```


