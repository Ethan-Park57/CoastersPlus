theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
stfplus_pitch_gam <- gam(est_woba ~ s(Stuff),
data = training,
family = gaussian, method = "REML")
selected_data <- training %>%
select(-c("mlbAM_ID"))
print(selected_data)
big_gam <- gam(est_woba ~., data = selected_data, family = gaussian, method = "REML")
stuff_predictions <- predict(stfplus_pitch_gam, newdata = testing, type = "response")
stuff_gam_pred <- data.frame(observed = testing$est_woba, prediction = stuff_predictions)
big_predictions <- predict(big_gam, newdata = testing, type = "response")
big_gam_pred <- data.frame(observed = testing$est_woba, prediction = big_predictions)
print(draw(stuff_gam_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(draw(big_game_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(stuff_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(gam_pred$observed, gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
print(big_game_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(big_game_pred$observed, big_game_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
stfplus_pitch_gam <- gam(est_woba ~ s(Stuff),
data = training,
family = gaussian, method = "REML")
selected_data <- training %>%
select(-c("mlbAM_ID", "Year", "player_name", "pitch_usage", "run_value_per_100"))
big_gam <- gam(est_woba ~., data = selected_data, family = gaussian, method = "REML")
stuff_predictions <- predict(stfplus_pitch_gam, newdata = testing, type = "response")
stuff_gam_pred <- data.frame(observed = testing$est_woba, prediction = stuff_predictions)
big_predictions <- predict(big_gam, newdata = testing, type = "response")
big_gam_pred <- data.frame(observed = testing$est_woba, prediction = big_predictions)
print(draw(stuff_gam_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(draw(big_game_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(stuff_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(gam_pred$observed, gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
print(big_game_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(big_game_pred$observed, big_game_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
stfplus_pitch_gam <- gam(est_woba ~ s(Stuff),
data = training,
family = gaussian, method = "REML")
selected_data <- training %>%
select(-c("mlbAM_ID", "Year", "player_name", "pitch_usage", "run_value_per_100"))
print(selected_data)
big_gam <- gam(est_woba ~., data = selected_data, family = gaussian, method = "REML")
stuff_predictions <- predict(stfplus_pitch_gam, newdata = testing, type = "response")
stuff_gam_pred <- data.frame(observed = testing$est_woba, prediction = stuff_predictions)
big_predictions <- predict(big_gam, newdata = testing, type = "response")
big_gam_pred <- data.frame(observed = testing$est_woba, prediction = big_predictions)
print(draw(stuff_gam_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(draw(big_game_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(stuff_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(gam_pred$observed, gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
print(big_game_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(big_game_pred$observed, big_game_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
stfplus_pitch_gam <- gam(est_woba ~ s(Stuff),
data = training,
family = gaussian, method = "REML")
selected_data <- training %>%
select(-c("mlbAM_ID", "Year", "player_name", "pitch_usage", "run_value_per_100"))
print(selected_data)
big_gam <- gam(est_woba ~ s(.), data = selected_data, family = gaussian, method = "REML")
stuff_predictions <- predict(stfplus_pitch_gam, newdata = testing, type = "response")
stuff_gam_pred <- data.frame(observed = testing$est_woba, prediction = stuff_predictions)
big_predictions <- predict(big_gam, newdata = testing, type = "response")
big_gam_pred <- data.frame(observed = testing$est_woba, prediction = big_predictions)
print(draw(stuff_gam_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(draw(big_game_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(stuff_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(gam_pred$observed, gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
print(big_game_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(big_game_pred$observed, big_game_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
stfplus_pitch_gam <- gam(est_woba ~ s(Stuff),
data = training,
family = gaussian, method = "REML")
selected_data <- training[, !(names(training) %in% c("mlbAM_ID", "Year", "player_name",
"pitch_usage", "run_value_per_100"))]
print(selected_data)
remaining_columns <- setdiff(names(selected_data), c("est_woba"))
formula <- as.formula(paste("est_woba ~ s(", paste(remaining_columns, collapse = "+"), ")"))
print(formula)
big_gam <- gam(formula, data = selected_data, family = gaussian, method = "REML")
stuff_predictions <- predict(stfplus_pitch_gam, newdata = testing, type = "response")
stuff_gam_pred <- data.frame(observed = testing$est_woba, prediction = stuff_predictions)
big_predictions <- predict(big_gam, newdata = testing, type = "response")
big_gam_pred <- data.frame(observed = testing$est_woba, prediction = big_predictions)
print(draw(stuff_gam_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(draw(big_game_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(stuff_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(gam_pred$observed, gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
print(big_game_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(big_game_pred$observed, big_game_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
stfplus_pitch_gam <- gam(est_woba ~ s(Stuff),
data = training,
family = gaussian, method = "REML")
selected_data <- training[, !(names(training) %in% c("mlbAM_ID", "Year", "player_name",
"pitch_usage", "run_value_per_100"))]
print(selected_data)
remaining_columns <- setdiff(names(selected_data), c("est_woba"))
rhs <- paste('s(', remaining_columns, ')', sep = '', collapse = ' + ')
fml <- paste('est_woba ~', rhs, collapse = ' ')
big_gam <- gam(as.formula(fml), data = selected_data, family = gaussian, method = "REML")
stuff_predictions <- predict(stfplus_pitch_gam, newdata = testing, type = "response")
stuff_gam_pred <- data.frame(observed = testing$est_woba, prediction = stuff_predictions)
big_predictions <- predict(big_gam, newdata = testing, type = "response")
big_gam_pred <- data.frame(observed = testing$est_woba, prediction = big_predictions)
print(draw(stuff_gam_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(draw(big_game_pred, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(stuff_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(gam_pred$observed, gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
print(big_game_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(big_game_pred$observed, big_game_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
stfplus_pitch_gam <- gam(est_woba ~ s(Stuff),
data = training,
family = gaussian, method = "REML")
selected_data <- training[, !(names(training) %in% c("mlbAM_ID", "Year", "player_name",
"pitch_usage", "run_value_per_100"))]
print(selected_data)
remaining_columns <- setdiff(names(selected_data), c("est_woba"))
rhs <- paste('s(', remaining_columns, ')', sep = '', collapse = ' + ')
fml <- paste('est_woba ~', rhs, collapse = ' ')
big_gam <- gam(as.formula(fml), data = selected_data, family = gaussian, method = "REML")
stuff_predictions <- predict(stfplus_pitch_gam, newdata = testing, type = "response")
stuff_gam_pred <- data.frame(observed = testing$est_woba, prediction = stuff_predictions)
big_predictions <- predict(big_gam, newdata = testing, type = "response")
big_gam_pred <- data.frame(observed = testing$est_woba, prediction = big_predictions)
print(draw(stfplus_pitch_gam, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(draw(big_gam, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(stuff_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(gam_pred$observed, gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
print(big_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(big_gam_pred$observed, big_gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
stfplus_pitch_gam <- gam(est_woba ~ s(Stuff),
data = training,
family = gaussian, method = "REML")
stuff_predictions <- predict(stfplus_pitch_gam, newdata = testing, type = "response")
stuff_gam_pred <- data.frame(observed = testing$est_woba, prediction = stuff_predictions)
print(draw(stfplus_pitch_gam, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(stuff_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(gam_pred$observed, gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
stfplus_pitch_gam <- gam(est_woba ~ s(Stuff),
data = training,
family = gaussian, method = "REML")
stuff_predictions <- predict(stfplus_pitch_gam, newdata = testing, type = "response")
stuff_gam_pred <- data.frame(observed = testing$est_woba, prediction = stuff_predictions)
print(draw(stfplus_pitch_gam, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(stuff_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(stuff_gam_pred$observed, stuff_gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
for (pitch_type in names(inters)) {
set.seed(2004)
split <- inters[[pitch_type]] %>%
distinct(mlbAM_ID) %>%
slice_sample(prop = 0.7)
training <- inters[[pitch_type]] %>%
filter(mlbAM_ID %in% split$mlbAM_ID)
testing <- inters[[pitch_type]] %>%
filter(!mlbAM_ID %in% split$mlbAM_ID)
selected_data <- training[, !(names(training) %in% c("mlbAM_ID", "Year", "player_name",
"pitch_usage", "run_value_per_100"))]
print(selected_data)
remaining_columns <- setdiff(names(selected_data), c("est_woba"))
rhs <- paste('s(', remaining_columns, ')', sep = '', collapse = ' + ')
fml <- paste('est_woba ~', rhs, collapse = ' ')
big_gam <- gam(as.formula(fml), data = selected_data, family = gaussian, method = "REML")
big_predictions <- predict(big_gam, newdata = testing, type = "response")
big_gam_pred <- data.frame(observed = testing$est_woba, prediction = big_predictions)
print(draw(big_gam, residuals = TRUE) & ggtitle(pitch_type)
& xlab("Stuff+")
& ylab("xwOBA Partial Effect"))
print(big_gam_pred %>%
ggplot(aes(x = observed, y = prediction)) +
geom_point(color = "#FDB827", shape = 18, size = 2.5, alpha = 0.8) +
geom_smooth(se = FALSE, method = lm) +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
scale_x_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05))) +
labs(x = "Observed",
y = "Predicted",
title = paste(pitch_type, " xwOBA GAM Predictions"),
caption = paste("RMSE:",
round(rmse(big_gam_pred$observed, big_gam_pred$prediction), 4))) +
theme_dark() +
theme(plot.title = element_text(hjust = 0.5)))
}
