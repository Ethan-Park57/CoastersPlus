y = "wOBA",
subtitle = "Spin Rate") +
scale_color_gradient(low = "red", high = "green") +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_x_continuous(labels = scales::comma) +
theme_dark() +
theme(plot.subtitle = element_text(hjust = 0.5))
g_sl_2 <- Data2 %>%
filter(pitch_type == "SL") %>%
ggplot(aes(x = avg_speed, y = woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7) +
geom_smooth(method = lm, se = FALSE) +
labs(x = "Average Pitch Speed (mph)",
y = "",
color = "Stuff+",
subtitle = "Speed") +
scale_y_reverse() +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_color_gradient(low = "red", high = "green") +
theme_dark()+
theme(plot.subtitle = element_text(hjust = 0.5),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
grid.arrange(g_sl_1, g_sl_2, ncol = 2, top = "wOBA on Sliders by Spin Rate & Speed")
g_fb_1 <- Data2 %>%
filter(pitch_type == "FC" | pitch_type == "FF" | pitch_type == "SI") %>%
ggplot(aes(x = spin_rate, y = woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7, show.legend = FALSE) +
geom_smooth(method = lm, se = FALSE, show.legend = FALSE) +
labs(x = "Spin Rate (rpm)",
y = "wOBA",
subtitle = "Spin Rate") +
scale_color_gradient(low = "red", high = "green") +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_x_continuous(labels = scales::comma) +
theme_dark() +
theme(plot.subtitle = element_text(hjust = 0.5))
g_fb_2 <- Data2 %>%
filter(pitch_type == "FC" | pitch_type == "FF" | pitch_type == "SI") %>%
ggplot(aes(x = avg_speed, y = woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7) +
geom_smooth(method = lm, se = FALSE) +
labs(x = "Average Pitch Speed (mph)",
y = "",
color = "Stuff+",
subtitle = "Speed") +
scale_y_reverse() +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_color_gradient(low = "red", high = "green") +
theme_dark()+
theme(plot.subtitle = element_text(hjust = 0.5),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
grid.arrange(g_fb_1, g_fb_2, ncol = 2, top = "wOBA on Fastballs by Spin Rate & Speed")
g_cu_1 <- Data2 %>%
filter(pitch_type == "CU") %>%
ggplot(aes(x = spin_rate, y = woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7, show.legend = FALSE) +
geom_smooth(method = lm, se = FALSE, show.legend = FALSE) +
labs(x = "Spin Rate (rpm)",
y = "wOBA",
subtitle = "Spin Rate") +
scale_color_gradient(low = "red", high = "green") +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_x_continuous(labels = scales::comma) +
theme_dark() +
theme(plot.subtitle = element_text(hjust = 0.5))
g_cu_2 <- Data2 %>%
filter(pitch_type == "CU") %>%
ggplot(aes(x = avg_speed, y = woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7) +
geom_smooth(method = lm, se = FALSE) +
labs(x = "Average Pitch Speed (mph)",
y = "",
color = "Stuff+",
subtitle = "Speed") +
scale_y_reverse() +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_color_gradient(low = "red", high = "green") +
theme_dark()+
theme(plot.subtitle = element_text(hjust = 0.5),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
grid.arrange(g_cu_1, g_cu_2, ncol = 2, top = "wOBA on Curveballs by Spin Rate & Speed")
g_ch_1 <- Data2 %>%
filter(pitch_type == "CH" | pitch_type == "FS") %>%
ggplot(aes(x = spin_rate, y = woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7, show.legend = FALSE) +
geom_smooth(method = lm, se = FALSE, show.legend = FALSE) +
labs(x = "Spin Rate (rpm)",
y = "wOBA",
subtitle = "Spin Rate") +
scale_color_gradient(low = "red", high = "green") +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_x_continuous(labels = scales::comma) +
theme_dark() +
theme(plot.subtitle = element_text(hjust = 0.5))
g_ch_2 <- Data2 %>%
filter(pitch_type == "CH" | pitch_type == "FS") %>%
ggplot(aes(x = avg_speed, y = woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7) +
geom_smooth(method = lm, se = FALSE) +
labs(x = "Average Pitch Speed (mph)",
y = "",
color = "Stuff+",
subtitle = "Speed") +
scale_y_reverse() +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_color_gradient(low = "red", high = "green") +
theme_dark()+
theme(plot.subtitle = element_text(hjust = 0.5),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
grid.arrange(g_ch_1, g_ch_2, ncol = 2, top = "wOBA on Curveballs by Spin Rate & Speed")
gx_sl_1 <- Data2 %>%
filter(pitch_type == "SL") %>%
ggplot(aes(x = spin_rate, y = est_woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7, show.legend = FALSE) +
geom_smooth(method = lm, se = FALSE, show.legend = FALSE) +
labs(x = "Spin Rate (rpm)",
y = "xwOBA",
subtitle = "Spin Rate") +
scale_color_gradient(low = "red", high = "green") +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_x_continuous(labels = scales::comma) +
theme_dark() +
theme(plot.subtitle = element_text(hjust = 0.5))
gx_sl_2 <- Data2 %>%
filter(pitch_type == "SL") %>%
ggplot(aes(x = avg_speed, y = est_woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7) +
geom_smooth(method = lm, se = FALSE) +
labs(x = "Average Pitch Speed (mph)",
y = "",
color = "Stuff+",
subtitle = "Speed") +
scale_y_reverse() +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_color_gradient(low = "red", high = "green") +
theme_dark()+
theme(plot.subtitle = element_text(hjust = 0.5),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
grid.arrange(gx_sl_1, gx_sl_2, ncol = 2, top = "xwOBA on Sliders by Spin Rate & Speed")
gx_fb_1 <- Data2 %>%
filter(pitch_type == "FC" | pitch_type == "FF" | pitch_type == "SI") %>%
ggplot(aes(x = spin_rate, y = est_woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7, show.legend = FALSE) +
geom_smooth(method = lm, se = FALSE, show.legend = FALSE) +
labs(x = "Spin Rate (rpm)",
y = "xwOBA",
subtitle = "Spin Rate") +
scale_color_gradient(low = "red", high = "green") +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_x_continuous(labels = scales::comma) +
theme_dark() +
theme(plot.subtitle = element_text(hjust = 0.5))
gx_fb_2 <- Data2 %>%
filter(pitch_type == "FC" | pitch_type == "FF" | pitch_type == "SI") %>%
ggplot(aes(x = avg_speed, y = est_woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7) +
geom_smooth(method = lm, se = FALSE) +
labs(x = "Average Pitch Speed (mph)",
y = "",
color = "Stuff+",
subtitle = "Speed") +
scale_y_reverse() +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_color_gradient(low = "red", high = "green") +
theme_dark()+
theme(plot.subtitle = element_text(hjust = 0.5),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
grid.arrange(gx_fb_1, gx_fb_2, ncol = 2, top = "xwOBA on Fastballs by Spin Rate & Speed")
gx_cu_1 <- Data2 %>%
filter(pitch_type == "CU") %>%
ggplot(aes(x = spin_rate, y = est_woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7, show.legend = FALSE) +
geom_smooth(method = lm, se = FALSE, show.legend = FALSE) +
labs(x = "Spin Rate (rpm)",
y = "xwOBA",
subtitle = "Spin Rate") +
scale_color_gradient(low = "red", high = "green") +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_x_continuous(labels = scales::comma) +
theme_dark() +
theme(plot.subtitle = element_text(hjust = 0.5))
gx_cu_2 <- Data2 %>%
filter(pitch_type == "CU") %>%
ggplot(aes(x = avg_speed, y = est_woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7) +
geom_smooth(method = lm, se = FALSE) +
labs(x = "Average Pitch Speed (mph)",
y = "",
color = "Stuff+",
subtitle = "Speed") +
scale_y_reverse() +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_color_gradient(low = "red", high = "green") +
theme_dark()+
theme(plot.subtitle = element_text(hjust = 0.5),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
grid.arrange(gx_cu_1, gx_cu_2, ncol = 2, top = "xwOBA on Curveballs by Spin Rate & Speed")
gx_ch_1 <- Data2 %>%
filter(pitch_type == "CH" | pitch_type == "FS") %>%
ggplot(aes(x = spin_rate, y = est_woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7, show.legend = FALSE) +
geom_smooth(method = lm, se = FALSE, show.legend = FALSE) +
labs(x = "Spin Rate (rpm)",
y = "xwOBA",
subtitle = "Spin Rate") +
scale_color_gradient(low = "red", high = "green") +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_x_continuous(labels = scales::comma) +
theme_dark() +
theme(plot.subtitle = element_text(hjust = 0.5))
gx_ch_2 <- Data2 %>%
filter(pitch_type == "CH" | pitch_type == "FS") %>%
ggplot(aes(x = avg_speed, y = est_woba,
color = `Stf+ Pitch`)) +
geom_point(alpha = 0.7) +
geom_smooth(method = lm, se = FALSE) +
labs(x = "Average Pitch Speed (mph)",
y = "",
color = "Stuff+",
subtitle = "Speed") +
scale_y_reverse() +
scale_y_continuous(labels = scales::comma_format(accuracy = 0.001),
expand = expansion(mult = c(0, 0.05)),
trans = "reverse") +
scale_color_gradient(low = "red", high = "green") +
theme_dark()+
theme(plot.subtitle = element_text(hjust = 0.5),
axis.text.y = element_blank(),
axis.ticks.y = element_blank())
grid.arrange(gx_ch_1, gx_ch_2, ncol = 2, top = "xwOBA on Change-Ups by Spin Rate & Speed")
library(caret)
# rf_tune_grid <-expand.grid(mtry = seq(3, 18, by = 3), splitrule = "variance",
#                            min.node.size = 5)
# caret_mlb_rf <- train(war ~ ., data = model_mlb_data, method = "ranger",
#                       num.trees = 50, trControl = trainControl(method = "cv",
#                                                                number = 5),
#                       tuneGrid = rf_tune_grid)
rm(g_ch_1)
rm(g_ch_2)
rm(g_cu_1)
rm(g_cu_2)
rm(g_fb_1)
rm(g_fb_2)
rm(g_sl_1)
rm(g_sl_2)
rm(gx_ch_1)
rm(gx_ch_2)
rm(gx_cu_1)
rm(gx_cu_2)
rm(gx_fb_1)
rm(gx_fb_2)
rm(gx_sl_1)
rm(gx_sl_2)
rm(rv_changeup_model)
rm(rv_changeup_reduced)
rm(rv_curveball_model)
rm(rv_curveball_reduced)
rm(rv_slider_model)
rm(rv_slider_reduced)
rm(rv_fastball_model)
rm(rv_fastball_reduced)
rm(rv_fourseam_reduced)
rm(rv_cutter_reduced)
rm(rv_sinker_reduced)
rm(x_changeup_model)
rm(x_changeup_reduced)
rm(x_curveball_model)
rm(x_curveball_reduced)
rm(x_fastball_model)
rm(x_fastball_reduced)
rm(x_slider_model)
rm(x_slider_reduced)
rm(x_fourseam_reduced)
rm(x_cutter_reduced)
rm(x_sinker_reduced)
rm(changeup_model)
rm()
rm(curveball_model)
rm(curveball_reduced)
rm(slider_model)
rm(slider_model)
rm(slider_reduced)
rm(changeup_reduced)
rm(fastball_model)
rm(fastball_reduced)
rm(fourseam_reduced)
rm(cutter_reduced)
rm(sinker_reduced)
test1 <-  Data2 %>%
filter(pitch_type == "SL") %>%
select(avg_speed, wOBA)
test1 <-  Data2 %>%
filter(pitch_type == "SL") %>%
select(avg_speed, woba)
View(test1)
test1 <-  Data2 %>%
filter(pitch_type == "SL") %>%
select(woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z)
View(test1)
test_model <- ranger(woba ~., data = test1,
num.trees = 1000, importance = "impurity")
test1 <-  Data2 %>%
filter(pitch_type == "SL") %>%
filter(!is.na(spin_rate)) %>%
select(woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z)
test_model <- ranger(woba ~., data = test1,
num.trees = 1000, importance = "impurity")
View(test_model)
test_tune_grid <- expand.grid(mtry = seq(from = 3, to = 18, by = 3),
splitrule = "variance",
min.node.size = 5)
test_data <-  Data2 %>%
filter(pitch_type == "SL") %>%
filter(!is.na(spin_rate)) %>%
select(woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z)
test_model <- ranger(woba ~., data = test_data,
num.trees = 1000, importance = "impurity")
test_tune_grid <- expand.grid(mtry = seq(from = 3, to = 18, by = 3),
splitrule = "variance",
min.node.size = 5)
test_caret <- train(woba ~., data = test, method = "ranger",
num.trees = 1000,
trControl = trainControl(method = "cv", number = 5),
tuneGrid = test_tune_grid)
test_caret <- train(woba ~., data = test_data, method = "ranger",
num.trees = 1000,
trControl = trainControl(method = "cv", number = 5),
tuneGrid = test_tune_grid)
View(Data2)
test_tune_grid <- expand.grid(mtry = 1:4,
splitrule = "variance",
min.node.size = 5)
test_data <-  Data2 %>%
filter(pitch_type == "SL") %>%
filter(!is.na(spin_rate)) %>%
select(woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z, speed_diff)
test_model <- ranger(woba ~., data = test_data,
num.trees = 1000, importance = "impurity")
test_tune_grid <- expand.grid(mtry = 1:4,
splitrule = "variance",
min.node.size = 5)
test_data <-  Data2 %>%
filter(pitch_type == "SL") %>%
filter(!is.na(spin_rate)) %>%
select(woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z, speed_diff)
test_model <- ranger(woba ~., data = test_data,
num.trees = 1000, importance = "impurity")
test_data <-  Data2 %>%
filter(pitch_type == "SL") %>%
filter(!is.na(spin_rate), !is.na(speed_diff)) %>%
select(woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z, speed_diff)
test_model <- ranger(woba ~., data = test_data,
num.trees = 1000, importance = "impurity")
test_tune_grid <- expand.grid(mtry = 1:4,
splitrule = "variance",
min.node.size = 5)
test_caret <- train(woba ~., data = test_data, method = "ranger",
num.trees = 1000,
trControl = trainControl(method = "cv", number = 5),
tuneGrid = test_tune_grid)
View(test_caret)
summary(test_caret)
test_data <-  Data2 %>%
filter(pitch_type == "SL") %>%
filter(!is.na(spin_rate), !is.na(speed_diff)) %>%
select(woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z, speed_diff)
test_tune_grid <- expand.grid(mtry = 1:4,
splitrule = "variance",
min.node.size = 5)
test_caret <- train(woba ~., data = test_data, method = "ranger",
num.trees = 1000,
trControl = trainControl(method = "cv", number = 5),
tuneGrid = test_tune_grid)
test_data <-  Data2 %>%
filter(pitch_type == "SL") %>%
filter(!is.na(spin_rate), !is.na(speed_diff)) %>%
select(woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z, speed_diff)
count(test_data)
count(test_data)
length(test_data)
count(test_data)
test_train <- test_data %>%
sample(size = count(test_data) * 0.7)
test_train <- test_data %>%
sample(size = count(test_data)[1,1] * 0.7)
count(test_data)[1,1] * 0.7
n(test_data) * 0.7
n(test_data)
n(test_data %>% as.vector()) * 0.7
n(test_data) * 0.7
n(as.vector(test_data)) * 0.7
as.vector(test_data) %>% head
count(as.vector(test_data)) * 0.7
nrow(test_data)
nrow(test_data) * 0.7
test_train <- test_data %>%
sample(size = nrow(test_data) * 0.7)
test_train <- test_data %>%
sample(size = 200)
View(test_data)
View(Data2)
test_data <-  Data2 %>%
filter(pitch_type == "SL") %>%
filter(!is.na(spin_rate), !is.na(speed_diff)) %>%
select(pitcherid, woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z, speed_diff)
View(Data2)
test_data <-  Data2 %>%
filter(pitch_type == "SL") %>%
filter(!is.na(spin_rate), !is.na(speed_diff)) %>%
select(pitcher_id, woba, avg_speed, spin_rate, pitcher_break_x, pitcher_break_z, speed_diff)
test_data
nrow(test_data) * 0.7
test_data
test_data %>%
distinct(pitcher_id) %>%
test_train <- test_data %>%
test_tune_grid <- expand.grid(mtry = 1:4,
splitrule = "variance",
min.node.size = 5)
test_data %>%
distinct(pitcher_id)
train_pitcher_id <- test_data %>%
distinct(pitcher_id) %>%
slice_sample(prop = 0.7)
train_pitcher_id
train_pitcher_id <- test_data %>%
distinct(pitcher_id) %>%
slice_sample(prop = 0.7)
test_train <- test_data %>%
filter(pitcher_id %in% train_pitcher_id$pitcher_id)
test_test <- test_data %>%
filter(!pitcher_id %in% train_pitcher_id$pitcher_id)
View(test_test)
test_tune_grid <- expand.grid(mtry = 1:4,
splitrule = "variance",
min.node.size = 5)
test_caret <- train(woba ~., data = test_train, method = "ranger",
num.trees = 1000,
trControl = trainControl(method = "cv", number = 5),
tuneGrid = test_tune_grid)
?predict
test_test %>%
mutate(Prediction = predict(test_caret, test_test))
View(test_test)
see <- test_test %>%
mutate(Prediction = predict(test_caret, test_test))
View(see)
test_test %>%
mutate(Prediction = predict(test_caret, test_test)) %>%
ggplot(aes(x = woba, y = Prediction)) %>%
geom_point()
test_test %>%
mutate(Prediction = predict(test_caret, test_test)) %>%
ggplot(aes(x = woba, y = Prediction)) +
geom_point()
predict(test_caret, test_test)
predict(test_caret, test_test) %>% length()
test_test %>%
mutate(Prediction = predict(test_caret, test_test)) %>%
ggplot(aes(x = woba, y = Prediction)) +
geom_point()
